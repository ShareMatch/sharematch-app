/**
 * Signup Flow Tests
 * 
 * Auto-generated by CodeGenerator Agent
 * Generated at: 2026-01-07T11:50:57.091Z
 * Risk Level: HIGH
 * 
 * Scenarios:
 *   - Signup with empty fields (negative)
 *   - Signup with invalid email (negative)
 *   - Signup with password mismatch (negative)
 *   - Signup with SQL injection attempt (security)
 *   - Signup with cross-site scripting attempt (security)
 *   - Signup with referral code (edge_case)
 *   - Signup with date of birth (edge_case)
 * 
 * DO NOT EDIT DIRECTLY - regenerate using the test planner
 */

import { test, expect } from '../../adapters';

const TEST_USER = {
  email: `test.${Date.now()}@example.com`,
  password: 'TestPassword123!',
  fullName: 'Test User',
  phone: '501234567',
  dob: { month: '0', year: '1990', day: '15' },
};

test.describe('Signup Flow', () => {
  
  test.beforeEach(async ({ supabaseAdapter }) => {
    console.log(`[Setup] Cleaning up test user: ${TEST_USER.email}`);
    await supabaseAdapter.deleteTestUser(TEST_USER.email);
  });
  
  test.afterEach(async ({ supabaseAdapter }) => {
    await supabaseAdapter.deleteTestUser(TEST_USER.email);
  });

  test('Signup with empty fields', async ({ page, supabaseAdapter }) => {
    console.log('[Test] Starting...');
    await page.locator('body').waitFor({ timeout: 5000 });
    await page.goto('/?action=signup');
    await page.locator('[data-testid="signup-continue-button"]').click();
    await expect(page.locator('.text-red-400')).toBeVisible();
    console.log('[Test] Completed');
  });

  test('Signup with invalid email', async ({ page, supabaseAdapter }) => {
    console.log('[Test] Starting...');
    await page.locator('body').waitFor({ timeout: 5000 });
    await page.goto('/?action=signup');
    await page.locator('#fullName').fill('John Doe');
    await page.locator('#email').fill('invalid_email');
    await page.locator('#password').fill('Password123!');
    await page.locator('#confirmPassword').fill('Password123!');
    await page.locator('[data-testid="signup-continue-button"]').click();
    await expect(page.locator('.text-red-400')).toBeVisible();
    console.log('[Test] Completed');
  });

  test('Signup with password mismatch', async ({ page, supabaseAdapter }) => {
    console.log('[Test] Starting...');
    await page.locator('body').waitFor({ timeout: 5000 });
    await page.goto('/?action=signup');
    await page.locator('#fullName').fill('John Doe');
    await page.locator('#email').fill('john@example.com');
    await page.locator('#password').fill('Password123!');
    await page.locator('#confirmPassword').fill('DifferentPassword');
    await page.locator('[data-testid="signup-continue-button"]').click();
    await expect(page.locator('.text-red-400')).toBeVisible();
    console.log('[Test] Completed');
  });

  test('Signup with SQL injection attempt', async ({ page, supabaseAdapter }) => {
    console.log('[Test] Starting...');
    await page.locator('body').waitFor({ timeout: 5000 });
    await page.goto('/');
    await page.locator('#fullName').fill('John Doe');
    await page.locator('#email').fill('john@example.com');
    await page.locator('#password').fill('Password123! OR 1=1');
    await page.locator('#confirmPassword').fill('Password123! OR 1=1');
    await page.locator('[data-testid="signup-continue-button"]').click();
    await expect(page.locator('.text-red-400')).toBeVisible();
    console.log('[Test] Completed');
  });

  test('Signup with cross-site scripting attempt', async ({ page, supabaseAdapter }) => {
    console.log('[Test] Starting...');
    await page.locator('body').waitFor({ timeout: 5000 });
    await page.goto('/?action=signup');
    await page.locator('#fullName').fill('<script>alert(\'XSS\')</script>');
    await page.locator('#email').fill('john@example.com');
    await page.locator('#password').fill('Password123!');
    await page.locator('#confirmPassword').fill('Password123!');
    await page.locator('[data-testid="signup-continue-button"]').click();
    await expect(page.locator('.text-red-400')).toBeVisible();
    console.log('[Test] Completed');
  });

  test('Signup with referral code', async ({ page, supabaseAdapter }) => {
    console.log('[Test] Starting...');
    await page.locator('body').waitFor({ timeout: 5000 });
    await page.goto('/?action=signup');
    await page.locator('#fullName').fill('John Doe');
    await page.locator('#email').fill('john@example.com');
    await page.locator('#password').fill('Password123!');
    await page.locator('#confirmPassword').fill('Password123!');
    await page.locator('#referralCode').fill('REFERRAL_CODE');
    await page.locator('[data-testid="signup-continue-button"]').click();
    await expect(page.locator('[data-testid="signup-modal"]')).toBeVisible();
    console.log('[Test] Completed');
  });

  test('Signup with date of birth', async ({ page, supabaseAdapter }) => {
    console.log('[Test] Starting...');
    await page.locator('body').waitFor({ timeout: 5000 });
    await page.goto('/?action=signup');
    await page.locator('#fullName').fill('John Doe');
    await page.locator('#email').fill('john@example.com');
    await page.locator('#password').fill('Password123!');
    await page.locator('#confirmPassword').fill('Password123!');
    await page.locator('button:has-text("Select date of birth")').click();
    await expect(page.locator('[data-testid="signup-modal"]')).toBeVisible();
    console.log('[Test] Completed');
  });
});